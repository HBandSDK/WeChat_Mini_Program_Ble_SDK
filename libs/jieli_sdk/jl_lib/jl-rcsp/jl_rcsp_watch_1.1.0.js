const e="杰理-RCSP";function t(t){let a=new Date;const n=a.getFullYear(),r=a.getMonth()+1,i=a.getDate(),l=a.getHours(),h=a.getMinutes(),c=a.getSeconds(),o=a.getMilliseconds();return`${[n,r,i].map(s).join("/")} ${[l,h,c,o].map(s).join(":")}`+":"+e+"--\x3e"+t}const s=e=>(e=e.toString())[1]?e:`0${e}`;var a,n=1;function r(e){n=e}function i(e){a=e}var l,h=new Map;function c(e){let t=h.get(e);return t||!0}function o(e,s){s&&!c(s)||n<=1&&null!=a&&a.logv(t(e))}function u(e,s){s&&!c(s)||n<=2&&null!=a&&a.logd(t(e))}function d(e,s){s&&!c(s)||n<=3&&null!=a&&a.logi(t(e))}function p(e,s){s&&!c(s)||n<=4&&null!=a&&a.logw(t(e))}function _(e,s){s&&!c(s)||n<=5&&null!=a&&a.loge(t(e))}function R(e){return Array.prototype.map.call(new Uint8Array(e),(function(e){return("00"+e.toString(16)).slice(-2)})).join("")}function D(e){let t="";for(let s=0;s<e.length;s++){t+=("00"+e[s].toString(16)).slice(-2),s!=e.length-1&&(t+=":")}return t.toUpperCase()}class g{}g.DEFAULT_SEND_CMD_TIMEOUT=3e3,g.DEFAULT_PROTOCOL_MTU=530,function(e){e[e.CONNECTION_DISCONNECT=0]="CONNECTION_DISCONNECT",e[e.CONNECTION_CONNECTING=1]="CONNECTION_CONNECTING",e[e.CONNECTION_CONNECTED=2]="CONNECTION_CONNECTED"}(l||(l={}));class E{constructor(e,t){this.deviceId=e,t&&(this.name=t)}equals(e){return null!=e&&(this==e||this.deviceId==e.deviceId)}}class C{static getErrorDesc1(e){return this.getErrorDesc2(e,"")}static getErrorDesc2(e,t){let s="";switch(e){case C.ERROR_UNKNOWN:s="Unknown error.";break;case C.ERROR_NONE:s="Success";break;case C.ERROR_INVALID_PARAM:s="Invalid parameter.";break;case C.ERROR_DATA_FORMAT:s="Data formatting error.";break;case C.ERROR_NOT_FOUND_RESOURCE:s="No resources found.";break;case C.ERROR_UNKNOWN_DEVICE:s="Unknown device.";break;case C.ERROR_DEVICE_OFFLINE:s="Device went offline.";break;case C.ERROR_IO_EXCEPTION:s="I/O exceptions occur.";break;case C.ERROR_REPEAT_STATUS:s="Repeat state.";break;case C.ERROR_RESPONSE_TIMEOUT:s="Waiting for reply command timed out.";break;case C.ERROR_REPLY_BAD_STATUS:s="Device returned a bad status.";break;case C.ERROR_REPLY_BAD_RESULT:s="Device returned an error result.";break;case C.ERROR_NONE_PARSER:s="There is no associated parser."}return""==s||null==t||0==t.length?s:s+C.SEPARATOR+t}}C.ERROR_UNKNOWN=255,C.ERROR_NONE=0,C.ERROR_INVALID_PARAM=-1,C.ERROR_DATA_FORMAT=-2,C.ERROR_NOT_FOUND_RESOURCE=-3,C.ERROR_UNKNOWN_DEVICE=-32,C.ERROR_DEVICE_OFFLINE=-33,C.ERROR_IO_EXCEPTION=-35,C.ERROR_REPEAT_STATUS=-36,C.ERROR_RESPONSE_TIMEOUT=-64,C.ERROR_REPLY_BAD_STATUS=-65,C.ERROR_REPLY_BAD_RESULT=-66,C.ERROR_NONE_PARSER=-67,C.SEPARATOR="&_&";class A{convertToCmd(e){if(null==e)return null;let t=this.createCommand();if(null==t||t.getOpCode()!=e.getOpCode())return null;t.setCommand(e.isCommand()),t.setNeedResponse(e.isNeedResponse()),t.setReserve(e.getReserve());const s=e.getPayload();if(null!=s){let a;if(t.setPayload(s),a=e.isCommand()?t.getParam().parseData(s):null!=t.getResponse()?t.getResponse().parseData(s):C.ERROR_NONE_PARSER,a>=C.ERROR_NONE)return t}return null}}class f{constructor(){this._isCommand=!1,this._isNeedResponse=!1,this._reserve=0,this._opCode=0,this._sn=-1}isCommand(){return this._isCommand}setCommand(e){return this._isCommand=e,e||(this._isNeedResponse=!1),this}isNeedResponse(){return this._isNeedResponse}setNeedResponse(e){return this._isNeedResponse=e,this}getReserve(){return this._reserve}setReserve(e){return this._reserve=e,this}getOpCode(){return this._opCode}setOpCode(e){return this._opCode=e,this}getSn(){return this._sn}getPayload(){return this._payload}setPayload(e){if(this._payload=e,0!=e.byteLength){let t=0;this._isCommand||t++,e.byteLength>t&&(this._sn=e[t])}}toData(){let e=8,t=0;null!=this._payload&&(e+=this._payload.byteLength,t=this._payload.byteLength);let s=new Uint8Array(e);s[0]=254,s[1]=220,s[2]=186,s[e-1]=239;let a=0;this._isCommand&&(a|=128),this._isNeedResponse&&(a|=64),s[3]=a,s[4]=this._opCode;let n=this._isCommand?1:2;if(1==this._opCode&&n++,t<n)return _("RcspPacket: toData error: payload error."),null;if(s[5]=t>>8,s[6]=255&t,null!=this._payload){let e=new Uint8Array(this._payload);s.set(e,7)}return s}parseData(e){if(null==e||e.byteLength<=8)return _("RcspPacket: parseData : data is invalid param."),C.ERROR_INVALID_PARAM;for(let t=0;t<f.RCSP_HEAD.length;t++)if(f.RCSP_HEAD[t]!=e[t])return _("RcspPacket: parseData : head error, it is not rcsp data."),C.ERROR_DATA_FORMAT;let t=3,s=(255&e[t+2])<<8|255&e[t+3];if(s<1||s>e.byteLength-8)return _("RcspPacket: parseData : len error, it is not rcsp data."),C.ERROR_DATA_FORMAT;if(e[t+4+s]!=f.RCSP_END)return _("RcspPacket: parseData : end error, it is not rcsp data."),C.ERROR_DATA_FORMAT;const a=e[t];t++,this._isCommand=128==(128&a),this._isNeedResponse=64==(64&a),this._reserve=63&a,this._opCode=e[t],t++;const n=(255&e[t])<<8|255&e[t+1];t+=2;const r=new Uint8Array(n);for(let s=t;s<e.length;s++)r[s-t]=e[s];return this.setPayload(r),t+=n,t++,t}}f.RCSP_HEAD=[254,220,186],f.RCSP_END=239;class O extends f{constructor(e,t,s){super(),this.response=null,this.setOpCode(e),this.param=t,this.setResponse(s),this.setCommand(!0)}getParam(){return this.param}getResponse(){return this.response}getSn(){if(-1==super.getSn()){if(this.isCommand())return this.getParam().getSn();if(null!=this.getResponse())return this.getResponse().getSn()}return super.getSn()}setParam(e){this.param=e}setResponse(e){this.response=e,this.setNeedResponse(null!=e)}setSn(e){this.isCommand()?this.getParam().setSn(e):null!=this.getResponse()&&this.getResponse()?.setSn(e)}setStatus(e){null!=this.getResponse()&&this.getResponse()?.setStatus(e)}getStatus(){return null!=this.getResponse()?this.getResponse().getStatus():-1}toData(){let e;return this.isCommand()||this.setNeedResponse(!1),e=this.isCommand()?null==this.param?new Uint8Array(0):this.param.toData():null==this.response?new Uint8Array(0):this.response.toData(),this.setPayload(e),super.toData()}}class T{constructor(){this.sn=-1}setSn(e){this.sn=e}getSn(){return this.sn}getData(){return this.basePayload}setData(e){this.basePayload=e}toData(){let e=1;null!=this.basePayload&&(e+=this.basePayload.byteLength);let t=new Uint8Array(e);if(null!=this.sn?t[0]=this.sn:t[0]=0,null!=this.basePayload)for(let e=0;e<this.basePayload.byteLength;e++)t[e+1]=this.basePayload[e];return t}parseData(e){if(null==e||e.byteLength<1)return C.ERROR_INVALID_PARAM;if(this.sn=e[0],e.byteLength>1){let t=new Uint8Array(e.length-1);for(let s=1;s<e.length;s++)t[s-1]=e[s];this.basePayload=t}return 1}}class m{constructor(){this.status=-1,this.sn=-1}getStatus(){return this.status}getSn(){return this.sn}getPayload(){return this.payload}setStatus(e){this.status=e}setSn(e){this.sn=e}setPayload(e){this.payload=e}toData(){let e=2;null!=this.payload&&(e+=this.payload.byteLength);const t=new Uint8Array(e);if(t[0]=this.status,t[1]=this.sn,null!=this.payload)for(let e=0;e<this.payload.length;e++)t[e+2]=this.payload[e];return t}parseData(e){return e.byteLength<2?C.ERROR_INVALID_PARAM:(this.status=e[0],this.sn=e[1],e.byteLength>2&&(this.payload=new Uint8Array(e.length-2),this.payload.set(e.slice(2))),2)}}m.STATUS_UNKNOWN=255,m.STATUS_SUCCESS=0,m.STATUS_FAILED=1,m.STATUS_UNKNOWN_CMD=2,m.STATUS_BUSY=3,m.STATUS_NONE_RESOURCE=4,m.STATUS_CRC_ERROR=5,m.STATUS_ALL_DATA_CRC_ERROR=6,m.STATUS_INVALID_PARAM=7,m.STATUS_RESPONSE_DATA_OVER_LIMIT=8;class S extends m{constructor(){super(...arguments),this.result=S.RESULT_OK}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE||e.length>=t+1&&(this.result=255&e[t],t++),t}toData(){let e=0;const t=super.toData(),s=new Uint8Array(t.byteLength+1);return s.set(t,e),e+=t.length,s[e]=this.result,e+=1,s}}S.RESULT_OK=0,S.RESULT_FAIL=1;class M extends O{}class N{constructor(e,t){this.device=e,this.type=t}}N.DATA_TYPE_SEND=0,N.DATA_TYPE_RECEIVE=1;class I extends N{constructor(e,t,s,a){super(e,N.DATA_TYPE_SEND),this.reSendCount=0,this.sendTimestamp=0,this.command=t,this.timeoutMs=s,this.callback=a}}class y extends N{constructor(e,t){super(e,N.DATA_TYPE_RECEIVE),this.data=t}}class w extends Array{}class v{constructor(e,t,s,a){this.SEND_AGAIN_LIMIT=3,this.isCanHandler=!1,this.ioProxy=e,this.listener=a,this.deviceMtuManager=t,this.dataInfoCache=new w,this.rcspParser=new P(s),this.sendInfoArray=new Array,this.receiveInfoArray=new Array,this.sendTimeOutIDMap=new Map}startHandler(){this.isCanHandler=!0,this.rcspParser.resetCache()}stopHandler(){this.isCanHandler=!1,this.dataInfoCache.length>0&&this.dataInfoCache.forEach((e=>{let t=e.callback;if(null!=t){let s=C.ERROR_IO_EXCEPTION;t.onError(e.device,s,C.getErrorDesc1(s))}})),this.sendTimeOutIDMap.size>0&&this.sendTimeOutIDMap.forEach((e=>{clearTimeout(e)})),this.dataInfoCache.length=0,this.sendInfoArray.length=0,this.receiveInfoArray.length=0,this.sendTimeOutIDMap.clear()}addSendData(e){if(this._checkDataAvailable(e)){if(this.sendInfoArray.push(e),this.sendInfoArray.length>1)return void o("RCSPDataHandler: 放入数据缓冲区，等待发送");const t={complete:()=>{this._writeDataToDevice(this.sendInfoArray,t)}};this._writeDataToDevice(this.sendInfoArray,t)}}addReceiveData(e){if(this._checkDataAvailable(e)){if(this.receiveInfoArray.push(e),this.receiveInfoArray.length>1)return void o("RCSPDataHandler: 放入数据缓冲区，等待解析");const t={complete:()=>{this._parseDataFromDevice(this.receiveInfoArray,t)}};this._parseDataFromDevice(this.receiveInfoArray,t)}}destroy(){this.stopHandler()}_checkDataAvailable(e){if(null==e){const e=C.ERROR_INVALID_PARAM;return this.listener.onError(null,e,C.getErrorDesc2(e,"DataInfo is null")),!1}if(!this._isCanHandle()){const t=C.ERROR_IO_EXCEPTION;return this.listener.onError(e.device,t,C.getErrorDesc2(t,"The processing thread is not working.")),!1}return!0}_isCanHandle(){return this.isCanHandler}_writeDataToDevice(e,t){const s=e.shift();if(null==s){if(0==e.length)return;return t.fail?.(),void t.complete?.()}if(!this._sendData(s))return _("RCSPDataHandler: send data failed. Please check whether the device is connected."),this._callbackError(s,C.ERROR_IO_EXCEPTION,"send data failed."),t.fail?.(),void t.complete?.();{let e=new Date;s.sendTimestamp=e.getMilliseconds()}if(s.command.isNeedResponse()){-1==this.dataInfoCache.indexOf(s)&&this.dataInfoCache.push(s);let e=setTimeout((e=>{const t=e,s=t.reSendCount;p("RCSPDataHandler: "+t.command+", reSendCount: "+s+", limit: "+this.SEND_AGAIN_LIMIT);const a=this.dataInfoCache.indexOf(t);if(a>-1&&this.dataInfoCache.splice(a,1),s<this.SEND_AGAIN_LIMIT)t.reSendCount=s+1,this.addSendData(t);else{const e="Command[%x]"+t.command.getOpCode();this._callbackError(t,C.ERROR_RESPONSE_TIMEOUT,e)}}),s.timeoutMs,s);const t=this._getSendDataKey(s);this.sendTimeOutIDMap.set(t,e)}else this._callbackCmd(s);t.success?.(),t.complete?.()}_sendData(e){const t=e.command.toData();if(null==t||0==t.byteLength)return o("RCSPDataHandler: sendData : data is null."),!1;if(t.byteLength>this._getRCSPSendMtu(e.device))return _("RCSPDataHandler: sendData : data over limit. RCSP mtu = "+this._getRCSPSendMtu(e.device)),!1;let s=!1;for(let a=0;a<3&&(s=this.ioProxy.sendDataToDevice(e.device,t),!s);a++);return s}_parseDataFromDevice(e,t){const s=e.shift();if(null==s){if(0==e.length)return;return t.fail?.(),void t.complete?.()}const a=this.rcspParser.findPacketData(this._getRCSPReceiveMtu(s.device),s.data);if(0==a.length)return t.fail?.(),void t.complete?.();a.forEach((e=>{if(e.isCommand()){const t=this.rcspParser.convertToCmd(e);if(null==t){const t=C.ERROR_NONE_PARSER;this.listener.onError(s.device,t,C.getErrorDesc2(t," Command op code = "+e.getOpCode()))}else this.listener.onRcspCommand(s.device,t)}else{const t=this._pollSendDataInfo(this.dataInfoCache,e);if(null==t)o("RCSPDataHandler: MSG_RECEIVE_DATA : no found cacheDataInfo.");else{o("RCSPDataHandler: MSG_RECEIVE_DATA : "+t);const a=this._getSendDataKey(t),n=this.sendTimeOutIDMap.get(a);null!=n&&(clearTimeout(n),this.sendTimeOutIDMap.delete(a));const r=t.command;if(null==r.getResponse())o("RCSPDataHandler: MSG_RECEIVE_DATA : no found command response.");else{const a=r.getResponse().parseData(e.getPayload());if(o("RCSPDataHandler: MSG_RECEIVE_DATA : ret = "+a),a>=C.ERROR_NONE)this.listener.onRcspResponse(s.device,r),this._callbackCmd(t);else{const s="The response of the command"+e.getOpCode()+" parse error. reason : "+a;o("RCSPDataHandler: "+s),this._callbackError(t,C.ERROR_DATA_FORMAT,s)}}}}}))}_callbackError(e,t,s){null!=e.callback&&e.callback.onError(e.device,t,C.getErrorDesc2(t,s)),this.listener.onError(e.device,t,C.getErrorDesc1(t))}_callbackCmd(e){null!=e.callback&&e.callback.onCmdResponse(e.device,e.command)}_getRCSPSendMtu(e){let t=this.deviceMtuManager.getReceiveMtu(e);return null!=t&&t>0?t:g.DEFAULT_PROTOCOL_MTU}_getRCSPReceiveMtu(e){let t=this.deviceMtuManager.getSendMtu(e);return null!=t&&t>0?t:g.DEFAULT_PROTOCOL_MTU}_getSendDataKey(e){if(null==e)return Number.MAX_VALUE;return e.command.getOpCode()<<16|e.command.getParam().getSn()}_pollSendDataInfo(e,t){if(0==e.length)return null;let s=null;if(e.forEach((e=>{t.isCommand()||e.command.getOpCode()!=t.getOpCode()||t.getSn()!=e.command.getParam().getSn()||(s=e)})),null!=s){let t=e.indexOf(s);t>-1&&e.splice(t,1)}return s}}class P{constructor(e){this.cacheBuf=null,this.cacheLen=0,this.cmdParserMap=e}getCmdParserMap(){return this.cmdParserMap}convertToCmd(e){if(null==e)return null;let t=this.getCmdParser(e.getOpCode());return null==t?null:t.convertToCmd(e)}getCmdParser(e){return this.getCmdParserMap().get(e)}resetCache(){this.cacheLen>0&&(this.cacheLen=0)}findPacketData(e,t){if(0==e||null==t||0==t.length)return new Array;const s=new Array,a=this._mergeCacheData(t),n=a.length;let r=0,i=0;for(;i<n;){if(r=this._findValidRcspHeadIndex(a,i,e),-1==r){d("RcspParser: findPacketData : not find head data.");break}const t=(255&a[r+5])<<8|255&a[r+6],n=new Uint8Array(8+t);for(let e=0;e<n.length;e++)n[e]=a[r+e];const l=new f,h=l.parseData(n);h>C.ERROR_NONE?(s.push(l),i=r+n.length):(_("RcspParser: findPacketData : parse data error.  code = "+h+", skip"),i++)}return s}_findValidRcspHeadIndex(e,t,s){if(null==e||0==e.byteLength)return-1;const a=e.byteLength;let n=a-t;if(n<=8)return o("RcspParser: findValidRcspHeadIndex : data is not enough. put data in cache."),this._putDataInCache(e,t,n),-1;let r=-1;for(let i=t;i<a;i++){if(e[i]!=f.RCSP_HEAD[0])continue;if(n=a-i,n<=8){this._putDataInCache(e,i,n);break}let t=!0;for(let s=0;s<f.RCSP_HEAD.length;s++)e[s+i]!=f.RCSP_HEAD[s]&&(t=!1);if(!t)continue;const l=i+f.RCSP_HEAD.length,h=(255&e[l+2])<<8|255&e[l+3];if(h<1||h>s-8){o("RcspParser: findPacketData :: data length["+h+"] over MAX_RECEIVE_MTU["+s+"], cast away"),i=l-1;continue}if(n<h+8){this._putDataInCache(e,i,n);break}if(e[l+4+h]==f.RCSP_END){r=i;break}i=l-1}return r}_mergeCacheData(e){if(null==e)return new Uint8Array(0);const t=e.byteLength;let s;if(this.cacheLen>0)s=new Uint8Array(this.cacheLen+t),this.cacheBuf&&s.set(this.cacheBuf),s.set(e,this.cacheLen),this.cacheLen=0;else{s=new Uint8Array(t);for(let t=0;t<e.length;t++)s[t]=e[t]}return s}_putDataInCache(e,t,s){if(null!=e&&e.byteLength>0&&t>=0&&s>0&&t+s<=e.byteLength){const a=e.slice(t,t+s);this.cacheBuf=a,this.cacheLen=s}}}class U{}let F=class{};F.CMD_UNKNOWN=0,F.CMD_DATA=1,F.CMD_GET_TARGET_FEATURE_MAP=2,F.CMD_GET_TARGET_INFO=3,F.CMD_DISCONNECT_CLASSIC_BLUETOOTH=6,F.CMD_GET_SYS_INFO=7,F.CMD_SET_SYS_INFO=8,F.CMD_SYS_INFO_AUTO_UPDATE=9,F.CMD_SWITCH_DEVICE_REQUEST=11,F.CMD_CUSTOM=240,F.CMD_EXTRA_CUSTOM=255,F.CMD_NOTIFY_DEVICE_APP_INFO=208,F.CMD_SETTINGS_COMMUNICATION_MTU=209,F.CMD_GET_DEV_MD5=212;let b=class{constructor(){this.cmdParserMap=new Map,this.cmdParserMap.set(F.CMD_DATA,new L),this.cmdParserMap.set(F.CMD_SYS_INFO_AUTO_UPDATE,new k),this.cmdParserMap.set(F.CMD_SETTINGS_COMMUNICATION_MTU,new x),this.cmdParserMap.set(F.CMD_CUSTOM,new H),this.cmdParserMap.set(F.CMD_EXTRA_CUSTOM,new V)}getCmdParserMap(){return this.cmdParserMap}};class L extends A{createCommand(){return new G(new B)}}class k extends A{createCommand(){return new Q(new q)}}class x extends A{createCommand(){return new se(new ae)}}class H extends A{createCommand(){return new ie(new T)}}class V extends A{createCommand(){return new re(new T)}}class G extends O{constructor(e){super(F.CMD_DATA,e,null)}}class B extends T{toData(){let e=0;const t=super.toData();let s=this.payload?.byteLength;null==s&&(s=0);const a=new Uint8Array(t.byteLength+1+s);return a.set(t,e),e+=t.length,null!=this.responseOpCode&&(a[e]=this.responseOpCode,e+=1),s>0&&(a.set(this.payload,e),e+=this.payload.length),a}parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;if(e.length<t+1)return C.ERROR_DATA_FORMAT;if(this.responseOpCode=255&e[t],t++,e.length>t){const s=new Uint8Array(e.length-t);s.set(e.slice(t)),t+=s.length,this.payload=s}return t}}class z extends m{toData(){let e=0;const t=super.toData(),s=new Uint8Array(t.byteLength+1);return s.set(t,e),e+=t.length,null!=this.responseOpCode&&(s[e]=this.responseOpCode,e+=1),s}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t+1?C.ERROR_DATA_FORMAT:(this.responseOpCode=255&e[t],t++,t)}}class W extends O{constructor(e){super(F.CMD_SET_SYS_INFO,e,new m)}}class Y extends O{constructor(e){super(F.CMD_GET_SYS_INFO,e,new j)}}class Q extends O{constructor(e){super(F.CMD_SYS_INFO_AUTO_UPDATE,e,null)}}class X{getLen(){let e=0;return null!=this.value&&null!=this.value&&(e=this.value.byteLength+1),e}toData(){let e=this.value?.length||0;const t=new Uint8Array(e+2);return t[0]=this.getLen(),t[1]=null==this.type?0:this.type,e>0&&t.set(this.value,2),t}parseData(e){if(null==e||e.length<2)return C.ERROR_INVALID_PARAM;let t=0;const s=255&e[t];if(t++,s<1||s>e.length-t)return C.ERROR_DATA_FORMAT;if(this.type=255&e[t],t++,s-1>0){const a=new Uint8Array(s-1);a.set(e.slice(t,t+s-1)),t+=a.length,this.value=a}return t}}class q extends T{toData(){let e=0;const t=super.toData();let s=new Uint8Array(t.byteLength+1);return s.set(t),e+=t.length,s[e]=null==this.function?0:this.function,e++,null!=this.dataList&&this.dataList.forEach((t=>{const a=t.toData(),n=s,r=new Uint8Array(n.byteLength+a.byteLength);r.set(n,0),r.set(a,n.byteLength),e+=a.length,s=r})),s}parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;if(e.length<t+1)return C.ERROR_DATA_FORMAT;this.function=255&e[t],t++;const s=e.length-t;if(s>0){const a=new Uint8Array(s);a.set(e.slice(t)),t+=a.length;let n=0;const r=new Array;for(;n+2<=a.length;){let e=new Uint8Array(a.length-n);e.set(a.slice(n,n+e.length));const t=new X,s=t.parseData(e);if(s<=0)break;r.push(t),n+=s}this.dataList=r}return t}}class K extends T{constructor(){super(...arguments),this.function=0,this.mask=0}toData(){let e=0;const t=super.toData(),s=new Uint8Array(t.byteLength+5);s.set(t),e+=t.length,s[e]=null==this.function?0:this.function,e++;const a=null==this.mask?0:this.mask;return s[e]=a>>24,s[e+1]=a>>16&255,s[e+2]=a>>8&255,s[e+3]=255&a,s}}class j extends m{parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;if(e.length<t+1)return C.ERROR_DATA_FORMAT;this.function=255&e[t],t++;const s=e.length-t;if(s>0){const a=new Uint8Array(s);a.set(e.slice(t)),t+=a.length;let n=0;for(this.dataList=new Array;n+2<=a.length;){const e=new Uint8Array(a.length-n);e.set(a.slice(n,n+e.length));const t=new X,s=t.parseData(e);if(s<=0)break;this.dataList.push(t),n+=s}}return t}}class J extends O{constructor(e){super(F.CMD_GET_TARGET_INFO,e,new $)}}J.FLAG_MANDATORY_UPGRADE=1;class Z extends T{constructor(e,t){super(),this.mask=e,this.platform=t}toData(){const e=super.toData(),t=new Uint8Array(e.length+5);let s=0;return t.set(e,0),s+=e.length,t[s]=this.mask>>24,t[s+1]=this.mask>>16&255,t[s+2]=this.mask>>8&255,t[s+3]=255&this.mask,t[s+4]=this.platform,t}}class $ extends m{constructor(){super(...arguments),this.versionCode=0,this.sendMtu=g.DEFAULT_PROTOCOL_MTU,this.receiveMtu=g.DEFAULT_PROTOCOL_MTU,this.edrStatus=0,this.edrProfile=0,this.platform=-1,this.volume=0,this.maxVol=0,this.quantity=0,this.functionMask=0,this.curFunction=0,this.btEnable=!1,this.devMusicEnable=!1,this.rtcEnable=!1,this.lineInEanble=!1,this.fmEnable=!1,this.lightEnable=!1,this.fmTXEnable=!1,this.eqEnable=!1,this.supportOfflineShow=!1,this.supportUsb=!0,this.supportSd0=!0,this.supportSd1=!0,this.hideNetRadio=!1,this.sdkType=0,this.pid=0,this.vid=0,this.uid=0,this.mandatoryUpgradeFlag=0,this.requestOtaFlag=0,this.ubootVersionCode=0,this.isSupportDoubleBackup=!1,this.isNeedBootLoader=!1,this.singleBackupOtaWay=0,this.expandMode=0,this.allowConnectFlag=0,this.bleOnly=!1,this.emitterSupport=!1,this.emitterStatus=0,this.isSupportMD5=!1,this.isGameMode=!1,this.isSupportSearchDevice=!1,this.supportVolumeSync=!1,this.supportSoundCard=!1,this.supportExternalFlashTransfer=!1,this.supportAnc=!1,this.banEq=!1,this.supportPackageCrc16=!1,this.getFileByNameWithDev=!1,this.contactsTransferBySmallFile=!1,this.watchSettingMask=0}parseData(e){let t=super.parseData(e);if(t<=C.ERROR_NONE)return t;if(e.length<t+2)return C.ERROR_INVALID_PARAM;const s=new Uint8Array(e.length-2);s.set(e.slice(2));let a=0,n=s.length;do{const e=255&s[a];if(a++,e<=0||e>n-a)return o("ResponseTargetInfo: parseData : data len over limit. It is a abnormal data."),C.ERROR_DATA_FORMAT;const t=255&s[a];a++;const r=new Uint8Array(e-1);0!=r.length?(r.set(s.slice(a,a+r.length)),a+=r.length,this.fillTargetInfo(t,r)):o("ResponseTargetInfo: parseData : type = "+t+", data is empty! Skip it.")}while(a+2<=n);return t+a}fillTargetInfo(e,t){switch(console.log("fillTargetInfo: number:"+e+" value: "+R(t)),o("fillTargetInfo: number:"+e+" value: "+R(t)),e){case 16:this.name=String.fromCharCode.apply(null,Array.from(t));break;case 0:{const e=t[0]>>4&15,s=15&t[0];this.protocolVersion="V"+e+"."+s;break}case 1:this.quantity=255&t[0],t.length>2&&(this.volume=255&t[1],this.maxVol=255&t[2]),t.length>3&&(this.supportVolumeSync=1==(1&t[3]));break;case 10:t.length>=6?(this.vid=(255&t[0])<<8|t[1],this.pid=(255&t[2])<<8|t[3],this.uid=(255&t[4])<<8|t[5]):4==t.length&&(this.vid=1494,this.uid=(255&t[0])<<8|t[1],this.pid=(255&t[2])<<8|t[3]);break;case 2:if(t.length>=6){const e=new Uint8Array(6);e.set(t.slice(0,e.length)),this.edrAddr=D(e)}t.length>=8&&(this.edrProfile=255&t[6],this.edrStatus=255&t[7]);break;case 3:t.length>1&&(this.platform=t[0],this.license=R(t.slice(1)));break;case 4:if(t.length>=5&&(this.functionMask=t[0]<<24|t[1]<<16|t[2]<<8|t[3],this.btEnable=1==(1&this.functionMask),this.devMusicEnable=2==(2&this.functionMask),this.rtcEnable=4==(4&this.functionMask),this.lineInEanble=8==(8&this.functionMask),this.fmEnable=16==(16&this.functionMask),this.lightEnable=32==(32&this.functionMask),this.fmTXEnable=64==(64&this.functionMask),this.eqEnable=128==(128&this.functionMask),this.curFunction=t[4],t.length>5)){const e=t[5];this.supportOfflineShow=1==(1&e),this.supportUsb=2==(2&e),this.supportSd0=4==(4&e),this.supportSd1=8==(8&e),this.hideNetRadio=16==(16&e)}break;case 5:if(t.length>=2){const e=(255&t[0])<<8|t[1],s="V_"+(e>>12&15)+"."+(e>>8&15)+"."+(e>>4&15)+"."+(15&e);this.versionCode=e,this.versionName=s}break;case 6:this.sdkType=t[0],this.supportVolumeSync||(this.supportVolumeSync=2==this.sdkType||4==this.sdkType);break;case 9:this.mandatoryUpgradeFlag=t[0],t.length>=2&&(this.requestOtaFlag=t[1]),t.length>=3&&(this.expandMode=t[2]);break;case 7:if(2==t.length){const e=(255&t[0])<<8|t[1],s="V_"+(e>>12&15)+"."+(e>>8&15)+"."+(e>>4&15)+"."+(15&e);this.ubootVersionCode=e,this.ubootVersionName=s}break;case 8:this.isSupportDoubleBackup=1==(255&t[0]),t.length>=2&&(this.isNeedBootLoader=1==(255&t[1])),t.length>=3&&(this.singleBackupOtaWay=t[2]);break;case 11:this.authKey=String.fromCharCode.apply(null,Array.from(t));break;case 12:this.projectCode=String.fromCharCode.apply(null,Array.from(t));break;case 13:t.length>=4?(this.sendMtu=(255&t[0])<<8|t[1],this.receiveMtu=(255&t[2])<<8|t[3]):2==t.length&&(this.sendMtu=(255&t[0])<<8|t[1],this.receiveMtu=this.sendMtu);break;case 14:this.allowConnectFlag=t[0];break;case 31:this.customVersionMsg=R(t);break;case 17:if(this.bleOnly=1==t[0],t.length>6){const e=new Uint8Array(6);e.set(t.slice(1,1+e.length)),this.bleAddr=D(e)}break;case 18:this.emitterStatus=t[0]>>4&15,this.emitterSupport=1==(15&t[0]);break;case 19:{const e=t[0];this.isSupportMD5=1==(1&e),this.isGameMode=1==(e>>1&1),this.isSupportSearchDevice=1==(e>>2&1),this.supportSoundCard=1==(e>>3&1),this.banEq=1==(e>>4&1),this.supportExternalFlashTransfer=1==(e>>5&1),this.supportAnc=1==(e>>6&1);break}case 20:break;case 21:t.length>=4&&(this.supportPackageCrc16=1==(1&t[0]),this.getFileByNameWithDev=2==(2&t[0]),this.contactsTransferBySmallFile=4==(4&t[0]))}}}class ee extends O{constructor(e){super(F.CMD_SWITCH_DEVICE_REQUEST,e,new S)}}class te extends T{constructor(e,t){super(),this.isSupportNewRebootWay=!1,this.communicationWay=e,t&&(this.isSupportNewRebootWay=t)}toData(){const e=super.toData(),t=new Uint8Array(e.length+2);let s=0;return t.set(e,s),s+=e.length,t[s]=this.communicationWay,t[s+1]=this.isSupportNewRebootWay?1:0,t}}class se extends O{constructor(e){super(F.CMD_SETTINGS_COMMUNICATION_MTU,e,new ne)}}class ae extends T{constructor(){super(...arguments),this.protocolMtu=0}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t+2?C.ERROR_DATA_FORMAT:(this.protocolMtu=(255&e[1])<<8|e[0],t+=2,t)}toData(){const e=super.toData(),t=new Uint8Array(e.byteLength);return t.set(e),t}}class ne extends m{constructor(){super(...arguments),this.realProtocolMtu=0}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t+2?C.ERROR_DATA_FORMAT:(this.realProtocolMtu=(255&e[1])<<8|e[0],t+=2,t)}toData(){const e=super.toData(),t=new Uint8Array(e.byteLength);return t.set(e),t}}class re extends O{constructor(e){super(F.CMD_EXTRA_CUSTOM,e,new m)}}class ie extends O{constructor(e){super(F.CMD_CUSTOM,e,new m)}}let le=class{};le.CMD_OTA_GET_DEVICE_UPDATE_FILE_INFO_OFFSET=225,le.CMD_OTA_INQUIRE_DEVICE_IF_CAN_UPDATE=226,le.CMD_OTA_ENTER_UPDATE_MODE=227,le.CMD_OTA_EXIT_UPDATE_MODE=228,le.CMD_OTA_SEND_FIRMWARE_UPDATE_BLOCK=229,le.CMD_OTA_GET_DEVICE_REFRESH_FIRMWARE_STATUS=230,le.CMD_REBOOT_DEVICE=231,le.CMD_OTA_NOTIFY_UPDATE_CONTENT_SIZE=232;let he=class{constructor(){this.cmdParserMap=new Map,this.cmdParserMap.set(le.CMD_OTA_EXIT_UPDATE_MODE,new ce),this.cmdParserMap.set(le.CMD_OTA_SEND_FIRMWARE_UPDATE_BLOCK,new oe),this.cmdParserMap.set(le.CMD_OTA_NOTIFY_UPDATE_CONTENT_SIZE,new ue)}getCmdParserMap(){return this.cmdParserMap}};class ce extends A{createCommand(){return new _e}}class oe extends A{createCommand(){return new Ee(new Ce)}}class ue extends A{createCommand(){return new Re(new De)}}class de extends O{constructor(){super(le.CMD_OTA_ENTER_UPDATE_MODE,new T,new pe)}}class pe extends m{constructor(){super(...arguments),this.result=S.RESULT_OK}parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;const s=e.length-t,a=new Uint8Array(s);return a.set(e.slice(t,t+a.length)),t+=a.length,this.result=a[0],t}toData(){let e=0;const t=super.toData(),s=new Uint8Array(t.byteLength+1);return s.set(t,e),e+=t.length,s[e]=this.result,e+=1,s}}class _e extends O{constructor(){super(le.CMD_OTA_EXIT_UPDATE_MODE,new T,new S)}}class Re extends O{constructor(e){super(le.CMD_OTA_NOTIFY_UPDATE_CONTENT_SIZE,e,new m)}}class De extends T{constructor(){super(...arguments),this.totalSize=0,this.currentSize=0}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t+4?C.ERROR_DATA_FORMAT:(this.totalSize=e[t+0]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4,e.length>=t+4&&(this.currentSize=e[t+0]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4),t)}toData(){const e=super.toData();let t;t=this.currentSize>0?e.length+8:e.length+4;const s=new Uint8Array(t);let a=0;return s.set(e,a),a+=e.length,s[a]=this.totalSize>>24,s[a+1]=this.totalSize>>16&255,s[a+2]=this.totalSize>>8&255,s[a+3]=255&this.totalSize,a+=4,this.currentSize>0&&(s[a]=this.totalSize>>24,s[a+1]=this.totalSize>>16&255,s[a+2]=this.totalSize>>8&255,s[a+3]=255&this.totalSize,a+=4),s}}class ge extends O{constructor(){super(le.CMD_OTA_GET_DEVICE_REFRESH_FIRMWARE_STATUS,new T,new S)}}ge.UPGRADE_RESULT_COMPLETE=0,ge.UPGRADE_RESULT_DATA_CHECK_ERROR=1,ge.UPGRADE_RESULT_FAIL=2,ge.UPGRADE_RESULT_ENCRYPTED_KEY_NOT_MATCH=3,ge.UPGRADE_RESULT_UPGRADE_FILE_ERROR=4,ge.UPGRADE_RESULT_UPGRADE_TYPE_ERROR=5,ge.UPGRADE_RESULT_ERROR_LENGTH=6,ge.UPGRADE_RESULT_FLASH_READ=7,ge.UPGRADE_RESULT_CMD_TIMEOUT=8,ge.UPGRADE_RESULT_DOWNLOAD_BOOT_LOADER_SUCCESS=128;class Ee extends O{constructor(e){super(le.CMD_OTA_SEND_FIRMWARE_UPDATE_BLOCK,e,new Ae)}}class Ce extends T{constructor(){super(...arguments),this.offset=0,this.len=0}toData(){const e=super.toData(),t=new Uint8Array(e.length+6);let s=0;return t.set(e,s),s+=e.length,t[s]=this.offset>>24,t[s+1]=this.offset>>16&255,t[s+2]=this.offset>>8&255,t[s+3]=255&this.offset,s+=4,t[s]=this.len>>8&255,t[s+1]=255&this.len,s+=2,t}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t+4+2?C.ERROR_DATA_FORMAT:(this.offset=e[t+0]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4,this.len=e[t+0]<<8|e[t+1],t+=2,t)}}class Ae extends m{toData(){const e=super.toData();if(null!=this.block&&this.block.length>0){const t=new Uint8Array(e.length+this.block.length);let s=0;return t.set(e,s),s+=e.length,t.set(this.block,s),s+=this.block.length,t}return e}parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;const s=e.length-t;if(0==s)return this.block=new Uint8Array(1),this.block[0]=0,t;const a=new Uint8Array(s);return a.set(e.slice(t,t+a.length)),t+=a.length,this.block=a,t}}class fe extends O{constructor(){super(le.CMD_OTA_GET_DEVICE_UPDATE_FILE_INFO_OFFSET,new T,new Oe)}}class Oe extends m{constructor(){super(...arguments),this.offset=0,this.len=0}toData(){const e=super.toData(),t=new Uint8Array(e.length+6);let s=0;return t.set(e,s),s+=e.length,t[s]=this.offset>>24,t[s+1]=this.offset>>16&255,t[s+2]=this.offset>>8&255,t[s+3]=255&this.offset,s+=4,t[s]=this.len>>8&255,t[s+1]=255&this.len,s+=2,t}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t+4+2?C.ERROR_DATA_FORMAT:(this.offset=e[t+0]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4,this.len=e[t+0]<<8|e[t+1],t+=2,t)}}class Te extends O{constructor(e){super(le.CMD_REBOOT_DEVICE,e,new S)}}class me extends T{constructor(e){super(),this.op=e}toData(){const e=super.toData(),t=new Uint8Array(e.length+1);let s=0;return t.set(e,s),s+=e.length,t[s]=255&this.op,s+=1,t}}me.OP_REBOOT=0,me.OP_CLOSE=1;class Se extends O{constructor(e){super(le.CMD_OTA_INQUIRE_DEVICE_IF_CAN_UPDATE,e,new S)}}Se.RESULT_CAN_UPDATE=0,Se.RESULT_DEVICE_LOW_VOLTAGE_EQUIPMENT=1,Se.RESULT_FIRMWARE_INFO_ERROR=2,Se.RESULT_FIRMWARE_VERSION_NO_CHANGE=3,Se.RESULT_TWS_NOT_CONNECT=4,Se.RESULT_HEADSET_NOT_IN_CHARGING_BIN=5;class Me extends T{constructor(e){super(),this.data=e}toData(){const e=super.toData();if(null!=this.data&&this.data.length>0){const t=new Uint8Array(e.length+this.data.length);let s=0;return t.set(e,s),s+=e.length,t.set(this.data,s),s+=1,t}return e}}function Ne(e){let t=e.toString(2);if(e<128)return e.toString(16);if(e<2048){t=("00000000000000000"+t).slice(-11);const e=parseInt("110"+t.substring(0,5),2),s=parseInt("10"+t.substring(5),2);return e.toString(16)+","+s.toString(16)}{t=("00000000000000000"+t).slice(-16);const e=parseInt("1110"+t.substring(0,4),2),s=parseInt("10"+t.substring(4,10),2),a=parseInt("10"+t.substring(10),2);return e.toString(16)+","+s.toString(16)+","+a.toString(16)}}function Ie(e){let t="";for(let s=0;s<e.length;s++)t+=","+Ne(e.charCodeAt(s));t+=",00";const s=t.match(/[\da-f]{2}/gi);return null!=s?new Uint8Array(s.map((function(e){return parseInt(e,16)}))).buffer:new Uint8Array(0)}function ye(e){return String.fromCharCode.apply(String,new Uint16Array(e))}function we(e){const t=new Uint8Array(4);return t[3]=255&e,t[2]=e>>8&255,t[1]=e>>16&255,t[0]=e>>24&255,t}function ve(e){const t=new Uint8Array(2);return t[1]=255&e,t[0]=e>>8&255,t}function Pe(e){return e[0]<<24|e[1]<<16|e[2]<<8|e[3]}function Ue(e){return e[0]<<8|e[1]}function Fe(e){return decodeURIComponent(escape(String.fromCharCode(...e)))}let be=class{};be.CMD_ADV_SETTINGS=192,be.CMD_ADV_GET_INFO=193,be.CMD_ADV_DEVICE_NOTIFY=194,be.CMD_ADV_NOTIFY_SETTINGS=195,be.CMD_ADV_DEV_REQUEST_OPERATION=196;let Le=class{constructor(){this.cmdParserMap=new Map,this.cmdParserMap.set(be.CMD_ADV_DEVICE_NOTIFY,new xe),this.cmdParserMap.set(be.CMD_ADV_DEV_REQUEST_OPERATION,new ke)}getCmdParserMap(){return this.cmdParserMap}};class ke extends A{createCommand(){return new je}}class xe extends A{createCommand(){return new Qe}}class He{constructor(){this.keyNum=0,this.action=0,this.function=0}toData(){const e=new Uint8Array(3);return e[0]=255&this.keyNum,e[1]=255&this.action,e[2]=255&this.function,e}}class Ve{constructor(){this.scene=0,this.effect=0}toData(){const e=new Uint8Array(2);return e[0]=255&this.scene,e[1]=255&this.effect,e}}class Ge extends O{constructor(e){super(be.CMD_ADV_SETTINGS,e,new S)}}class Be extends T{constructor(e){super(),this.payload=e}toData(){const e=super.toData(),t=new Uint8Array(e.length+this.payload.length);let s=0;return t.set(e,s),s+=e.length,t.set(this.payload,s),t}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t?C.ERROR_DATA_FORMAT:(this.payload=e.slice(t),t=e.length,t)}}class ze extends O{constructor(e){super(be.CMD_ADV_GET_INFO,e,new Ye)}}class We extends T{constructor(e){super(),this.mask=e}toData(){const e=super.toData(),t=new Uint8Array(e.length+4);let s=0;return t.set(e,s),s+=e.length,t[s]=this.mask>>24&255,t[s+1]=this.mask>>16&255,t[s+2]=this.mask>>8&255,t[s+3]=255&this.mask,s+=4,t}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t+4?C.ERROR_DATA_FORMAT:(this.mask=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4,t)}}class Ye extends m{constructor(){super(...arguments),this.pid=0,this.vid=0,this.uid=0,this.leftDeviceQuantity=0,this.isLeftCharging=!1,this.rightDeviceQuantity=0,this.isRightCharging=!1,this.chargingBinQuantity=0,this.isDeviceCharging=!1,this.micChannel=0,this.workModel=0,this.inEarSettings=0}parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;const s=e;if(null!=s&&s.length>0){let e=t;const a=s.length;for(;e+2<=a;){const t=s[e];if(!(t>0))return _("parseADVInfo :: data length"+t+" over MAX_COMMUNICATION_MTU[%d], cast away"),C.ERROR_DATA_FORMAT;{const n=s[e+1];let r=new Uint8Array(t-1);if(!(r.length>0&&r.length+e+2<=a)){if(0==r.length){e+=2;continue}return C.ERROR_DATA_FORMAT}switch(r=s.slice(e+2,e+2+r.length),e+=2+r.length,n){case 0:{const e=r[0]>>7&1,t=127&r[0];if(this.isLeftCharging=1==e,this.leftDeviceQuantity=t,r.length>=2){const e=r[1]>>7&1,t=127&r[1];if(this.isRightCharging=1==e,this.rightDeviceQuantity=t,r.length>=3){const e=r[2]>>7&1,t=127&r[2];this.isDeviceCharging=1==e,this.chargingBinQuantity=t}}continue}case 1:this.deviceName=ye(r);continue;case 2:{let e;if(null!=r&&r.length>=3){let t=0,s=new Uint8Array(3);for(;t<r.length&&t+3<=r.length;){s=r.slice(t,t+3),t+=s.length;const a=new He;a.keyNum=s[0],a.action=s[1],a.function=s[2],null==e&&(e=new Array),e.push(a)}}this.keySettingsList=e;continue}case 3:{let e;if(null!=r&&r.length>=2){let t=0;for(;t<r.length;){let s=r.slice(t,t+2);t+=2;const a=new Ve;a.scene=s[0],a.effect=s[1],null==e&&(e=new Array),e.push(a)}}this.ledSettingsList=e;continue}case 4:this.micChannel=r[0];continue;case 5:this.workModel=r[0];continue;case 6:r.length>=6&&(this.vid=((255&r[0])<<8)+(255&r[1]),this.uid=((255&r[2])<<8)+(255&r[3]),this.pid=((255&r[4])<<8)+(255&r[5]));continue;case 8:this.inEarSettings=r[0];continue;case 9:this.language=ye(r);continue;case 10:if(r.length>=4){const e=(255&r[0])<<24|(255&r[1])<<16|(255&r[2])<<8|255&r[3],t=new Array;for(let s=0;s<32;s++){1==(e>>s&1)&&t.push(s)}if(0!=t.length){let e=new Uint8Array(t.length);for(let s=0;s<t.length;s++){const a=t[s];null!=a&&(e[s]=a)}this.modes=e}}continue;default:p("-parseADVInfo- unknown type = "+n)}}}}return t=e.length,t}}class Qe extends O{constructor(){super(be.CMD_ADV_DEVICE_NOTIFY,new Xe,null)}}class Xe extends T{constructor(){super(...arguments),this.vid=0,this.pid=0,this.uid=0,this.deviceType=0,this.version=0,this.showDialog=!1,this.edrAddr="",this.seq=0,this.action=0,this.leftDeviceQuantity=0,this.leftCharging=!1,this.rightDeviceQuantity=0,this.rightCharging=!1,this.chargingBinQuantity=0,this.deviceCharging=!1}getVid(){return this.vid}setVid(e){return this.vid=e,this}getPid(){return this.pid}setPid(e){return this.pid=e,this}getUid(){return this.uid}setUid(e){return this.uid=e,this}getDeviceType(){return this.deviceType}setDeviceType(e){return this.deviceType=e,this}getVersion(){return this.version}setVersion(e){return this.version=e,this}isShowDialog(){return this.showDialog}setShowDialog(e){return this.showDialog=e,this}getEdrAddr(){return this.edrAddr}setEdrAddr(e){return this.edrAddr=e,this}getSeq(){return this.seq}setSeq(e){return this.seq=e,this}getAction(){return this.action}setAction(e){return this.action=e,this}getLeftDeviceQuantity(){return this.leftDeviceQuantity}setLeftDeviceQuantity(e){return this.leftDeviceQuantity=e,this}isLeftCharging(){return this.leftCharging}setLeftCharging(e){return this.leftCharging=e,this}getRightDeviceQuantity(){return this.rightDeviceQuantity}setRightDeviceQuantity(e){return this.rightDeviceQuantity=e,this}isRightCharging(){return this.rightCharging}setRightCharging(e){return this.rightCharging=e,this}getChargingBinQuantity(){return this.chargingBinQuantity}setChargingBinQuantity(e){return this.chargingBinQuantity=e,this}isDeviceCharging(){return this.deviceCharging}setDeviceCharging(e){return this.deviceCharging=e,this}parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;if(e.length<t+18)return C.ERROR_DATA_FORMAT;const s=new Uint8Array(18);return s.set(e.slice(t,t+18)),t+=18,this.fillADVInfo(s),t}fillADVInfo(e){this.setVid((e[0]<<8)+e[1]).setUid((e[2]<<8)+e[3]).setPid((e[4]<<8)+e[5]),this.setDeviceType(e[6]>>4&255).setVersion(15&e[6]);const t=new Uint8Array(6);t.set(e.slice(7,7+t.length)),this.setEdrAddr(D(t)).setAction(e[13]),this.setLeftCharging(1==(e[14]>>7&1)).setLeftDeviceQuantity(127&e[14]),this.setRightCharging(1==(e[15]>>7&1)).setRightDeviceQuantity(127&e[15]),this.setDeviceCharging(1==(e[16]>>7&1)).setChargingBinQuantity(127&e[16]),this.setSeq(e[17])}}class qe extends T{constructor(e){super(),this.op=-1,null!=e&&(this.op=e)}toData(){const e=super.toData(),t=new Uint8Array(e.length+1);let s=0;return t.set(e,s),s+=e.length,t[s]=this.op,t}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t+1?C.ERROR_DATA_FORMAT:(this.op=255&e[t],t++,t)}}class Ke extends O{constructor(e){super(be.CMD_ADV_NOTIFY_SETTINGS,new qe(e),new S)}}Ke.CTRL_OP_CLOSE=0,Ke.CTRL_OP_OPEN=1;class je extends O{constructor(){super(be.CMD_ADV_DEV_REQUEST_OPERATION,new qe,new m)}}je.REQUEST_OP_SYNC_SETTINGS=0,je.REQUEST_OP_UPDATE_SETTINGS_AND_REBOOT=1,je.REQUEST_OP_SYNC_CONNECTION_TIME=2,je.REQUEST_OP_RECONNECT_DEVICE=3,je.REQUEST_OP_SYNC_DEVICE_INFO=4;let Je=class{};Je.CMD_FUNCTION=14;let Ze=class{constructor(){this.cmdParserMap=new Map}getCmdParserMap(){return this.cmdParserMap}};class $e extends O{constructor(e){super(Je.CMD_FUNCTION,e,new S)}}class et extends T{constructor(){super(...arguments),this.function=0,this.childCmd=0,this.extendData=new Uint8Array(0)}toData(){const e=super.toData();let t;t=e.length+2+this.extendData.length;const s=new Uint8Array(t);let a=0;return s.set(e,a),a+=e.length,s[a]=255&this.function,s[a+1]=255&this.childCmd,a+=2,s.set(this.extendData,a),s}}let tt=class{};tt.CMD_START_FILE_BROWSE=12,tt.CMD_STOP_FILE_BROWSE=13,tt.CMD_LRC_GET_START=15,tt.CMD_LRC_GET_STOP=16;let st=class{constructor(){this.cmdParserMap=new Map,this.cmdParserMap.set(tt.CMD_STOP_FILE_BROWSE,new at),this.cmdParserMap.set(tt.CMD_LRC_GET_STOP,new nt)}getCmdParserMap(){return this.cmdParserMap}};class at extends A{createCommand(){return new ot}}class nt extends A{createCommand(){return new dt}}class rt{constructor(){this.pathType=0,this.readNums=10,this.startIndex=1,this.devHandler=0}toData(){if(null==this.path)return;const e=4*this.path.length,t=new Uint8Array(10+e);t[0]=this.pathType,t[1]=255&this.readNums,t[2]=this.startIndex>>8&255,t[3]=255&this.startIndex,t[4]=this.devHandler>>24&255,t[5]=this.devHandler>>16&255,t[6]=this.devHandler>>8&255,t[7]=255&this.devHandler,t[8]=e>>8&255,t[9]=255&e;const s=new Uint8Array(4*this.path.length);for(let e=0;e<this.path.length;e++){const t=this.path[e];s[4*e]=t>>24&255,s[4*e+1]=t>>16&255,s[4*e+2]=t>>8&255,s[4*e+3]=255&t}return t.set(s,10),t}}class it extends T{constructor(e){super(),this.pathData=e}toData(){const e=this.pathData?.toData(),t=e?.byteLength?e?.byteLength:0,s=super.toData(),a=new Uint8Array(s.length+t);let n=0;return a.set(s,n),n+=s.length,e&&a.set(e,n),a}}class lt extends m{constructor(){super(...arguments),this.totalFileNum=0}parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;switch(e.length-t){case 1:this.totalFileNum=255&e[t];break;case 2:this.totalFileNum=(255&e[t])<<8|255&e[t+1];break;case 4:this.totalFileNum=(255&e[t+0])<<24|(255&e[t+1])<<16|(255&e[t+2])<<8|255&e[t+3]}return t=e.length,t}}class ht extends O{constructor(e){super(tt.CMD_START_FILE_BROWSE,e,new lt)}}class ct extends T{parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t+1?C.ERROR_DATA_FORMAT:(this.stopReason=255&e[t],t++,t)}}class ot extends O{constructor(){super(tt.CMD_STOP_FILE_BROWSE,new ct,new m)}}class ut extends O{constructor(){super(tt.CMD_LRC_GET_START,new T,new m)}}class dt extends O{constructor(){super(tt.CMD_LRC_GET_STOP,new T,new m)}}let pt=class{};pt.CMD_START_LARGE_FILE_TRANSFER=27,pt.CMD_STOP_LARGE_FILE_TRANSFER=28,pt.CMD_LARGE_FILE_TRANSFER_OP=29,pt.CMD_CANCEL_LARGE_FILE_TRANSFER=30,pt.CMD_LARGE_FILE_TRANSFER_GET_NAME=32,pt.CMD_READ_FILE_FROM_DEVICE=36;let _t=class{constructor(){this.cmdParserMap=new Map,this.cmdParserMap.set(pt.CMD_STOP_LARGE_FILE_TRANSFER,new Rt),this.cmdParserMap.set(pt.CMD_LARGE_FILE_TRANSFER_OP,new Dt),this.cmdParserMap.set(pt.CMD_CANCEL_LARGE_FILE_TRANSFER,new gt),this.cmdParserMap.set(pt.CMD_LARGE_FILE_TRANSFER_GET_NAME,new Et),this.cmdParserMap.set(pt.CMD_READ_FILE_FROM_DEVICE,new Ct)}getCmdParserMap(){return this.cmdParserMap}};class Rt extends A{createCommand(){return new Tt(new mt)}}class Dt extends A{createCommand(){return new St(new Mt)}}class gt extends A{createCommand(){return new Nt}}class Et extends A{createCommand(){return new It}}class Ct extends A{createCommand(){return new wt}}class At extends O{constructor(e){super(pt.CMD_START_LARGE_FILE_TRANSFER,e,new Ot)}}class ft extends T{constructor(e,t,s){super(),this.hash=null,this.size=0,this.crc16=0,this.hash=e,this.size=t,this.crc16=s}toData(){const e=super.toData(),t=new Uint8Array(e.length+19);let s=0;return t.set(e,s),s+=e.byteLength,t[s]=this.size>>24,t[s+1]=this.size>>16&255,t[s+2]=this.size>>8&255,t[s+3]=255&this.size,s+=4,t[s]=this.crc16>>8&255,t[s+1]=255&this.crc16,s+=2,null!=this.hash&&t.set(this.hash,s),t}}class Ot extends m{constructor(){super(...arguments),this.transferMTU=265}toData(){const e=super.toData(),t=new Uint8Array(e.length+6);let s=0;return t.set(e,s),s+=e.length,t[s]=this.transferMTU>>8&255,t[s+1]=255&this.transferMTU,s+=2,t}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE||e.length>=t+2&&(this.transferMTU=e[t+0]<<8|e[t+1],t+=2),t}}class Tt extends O{constructor(e){super(pt.CMD_STOP_LARGE_FILE_TRANSFER,e,new m)}}class mt extends T{constructor(){super(...arguments),this.reason=0}toData(){const e=super.toData(),t=new Uint8Array(e.length+1);let s=0;return t.set(e,s),s+=e.length,t[s]=this.reason,s+=1,t}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t+1?C.ERROR_DATA_FORMAT:(this.reason=e[t+0],t+=1,t)}}class St extends O{constructor(e){super(pt.CMD_LARGE_FILE_TRANSFER_OP,e,null)}}class Mt extends T{constructor(){super(...arguments),this.op=0,this.buffer=0,this.offset=0}toData(){const e=super.toData(),t=new Uint8Array(e.length+6);let s=0;return t.set(e,s),s+=e.length,t[s]=255&this.op,s+=1,t[s]=this.buffer>>8&255,t[s+1]=255&this.buffer,s+=2,t[s]=this.offset>>24,t[s+1]=this.offset>>16&255,t[s+2]=this.offset>>8&255,t[s+3]=255&this.offset,s+=4,t}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t+1+2+4?C.ERROR_DATA_FORMAT:(this.op=e[t],t+=1,this.buffer=e[t+0]<<8|e[t+1],t+=2,this.offset=e[t+0]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4,t)}}class Nt extends O{constructor(){super(pt.CMD_CANCEL_LARGE_FILE_TRANSFER,new T,new m)}}class It extends O{constructor(){super(pt.CMD_LARGE_FILE_TRANSFER_GET_NAME,new T,new yt)}}class yt extends m{toData(){const e=super.toData();if(null!=this.fileName&&this.fileName.length>0){const t=new Uint8Array(e.length+this.fileName.length);let s=0;return t.set(e,s),s+=e.length,t.set(this.fileName,s),s+=this.fileName.length,t}return e}parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;const s=e.length-t;if(0==s)return this.fileName=new Uint8Array(1),this.fileName[0]=0,t;const a=new Uint8Array(s);return a.set(e.slice(t,t+a.length)),t+=a.length,this.fileName=a,t}}class wt extends O{constructor(e){const t=null==e?new vt:e,s=new kt;super(pt.CMD_READ_FILE_FROM_DEVICE,t,s),s.setCommand(this),t.setCommand(this)}}class vt extends T{constructor(){super(...arguments),this.op=0,this._isNeedHandleOp=!0}setCommand(e){this._cmd=e}toData(){const e=super.toData();let t,s=this.getParamData();t=new Uint8Array(e.byteLength+1+s.length);let a=0;return t.set(e,a),a+=e.byteLength,t[a++]=this.op,s&&(t.set(s,a),a+=s.length),t}parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;if(e.length<t+2)return C.ERROR_DATA_FORMAT;if(this.op=e[t++],this._isNeedHandleOp){let s;switch(this.op){case 0:s=new Pt;break;case 1:s=new Ut;break;case 2:s=new Ft;break;case 128:s=new bt;break;case 129:s=new Lt}s?t=s.parseData(e):s=this,this._cmd?.setParam(s)}else{const s=this.parseParamData(e.slice(t));s<0?t=s:t+=s}return t}getParamData(){return new Uint8Array}parseParamData(e){return e.length}}class Pt extends vt{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=0,this.offset=0}getParamData(){let e=4;this.fileName&&(e+=this.fileName.length);const t=new Uint8Array(e);let s=0;return t.set(we(this.offset),s),s+=4,this.fileName&&t.set(this.fileName,s),t}parseParamData(e){let t=0;return e.length<4?C.ERROR_DATA_FORMAT:(this.offset=Pe(e.slice(t,t+=4)),this.fileName=e.slice(t),t)}}class Ut extends vt{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=1}getParamData(){const e=new Uint8Array(12);if(null!=this.devHandle&&null!=this.cluster&&null!=this.offset){let t=0;e.set(we(this.devHandle),t),t+=4,e.set(we(this.offset),t),t+=4,e.set(we(this.cluster),t),t+=4}return e}parseParamData(e){let t=0;return e.length<12?C.ERROR_DATA_FORMAT:(this.devHandle=Pe(e.slice(t,t+=4)),this.offset=Pe(e.slice(t,t+=4)),this.cluster=Pe(e.slice(t,t+=4)),t)}}class Ft extends vt{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=2,this.devHandle=0,this.offset=0}getParamData(){let e=9;this.fileName&&(e+=this.fileName.length);const t=new Uint8Array(e);let s=0;return t.set(we(this.devHandle),s),s+=4,t.set(we(this.offset),s),s+=4,this.fileName&&(t[s]=255&this.fileName.length,s++,t.set(this.fileName,s)),t}parseParamData(e){let t=0;if(e.length<9)return C.ERROR_DATA_FORMAT;this.devHandle=Pe(e.slice(t,t+=4)),this.offset=Pe(e.slice(t,t+=4));const s=e[t];return t++,e.length<9+s?C.ERROR_DATA_FORMAT:(this.fileName=e.slice(t),t)}}class bt extends vt{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=128}getParamData(){if(null!=this.ret){const e=new Uint8Array(1);return e[0]=255&this.ret,e}return new Uint8Array}parseParamData(e){let t=0;return e.length<1?C.ERROR_DATA_FORMAT:(this.ret=e[t],t++,t)}}class Lt extends vt{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=129}getParamData(){if(null!=this.reason){const e=new Uint8Array(1);return e[0]=255&this.reason,e}return new Uint8Array}parseParamData(e){let t=0;return e.length<1?C.ERROR_DATA_FORMAT:(this.reason=e[t],t++,t)}}class kt extends m{constructor(){super(...arguments),this.op=0,this._isNeedHandleOp=!0}setCommand(e){this._cmd=e}toData(){const e=super.toData();let t,s=this.getParamData();t=new Uint8Array(e.byteLength+1+s.length);let a=0;return t.set(e,a),a+=e.byteLength,t[a++]=this.op,s&&(t.set(s,a),a+=s.length),t}getParamData(){return new Uint8Array}parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;if(e.length<t+1)return C.ERROR_DATA_FORMAT;if(this.op=e[t++],console.log("解析数据"+this._isNeedHandleOp+this.op),this._isNeedHandleOp){let s;switch(this.op){case 0:case 1:case 2:s=new xt;break;case 128:case 129:s=new Ht}s?t=s.parseData(e):s=this,this._cmd?.setResponse(s)}else{const s=this.parseParamData(e.slice(t));s<0?t=s:t+=s}return t}parseParamData(e){return e.length}}class xt extends kt{constructor(){super(...arguments),this._isNeedHandleOp=!1}getParamData(){const e=new Uint8Array(4);if(null!=this.fileSize){let t=0;e.set(we(this.fileSize),t),t+=4}return e}parseParamData(e){let t=0;return e.length>=4&&(this.fileSize=Pe(e.slice(t,t+=4)),console.log(" fileSize "+this.fileSize)),t}}class Ht extends kt{constructor(){super(...arguments),this._isNeedHandleOp=!1}}let Vt=class{};Vt.CMD_FILE_BROWSE_DELETE=31,Vt.CMD_NOTIFY_PREPARE_ENV=33,Vt.CMD_FORMAT_DEVICE=34,Vt.CMD_DELETE_FILE_BY_NAME=35,Vt.CMD_DEV_PARAM_EXTEND=39;let Gt=class{constructor(){this.cmdParserMap=new Map,this.cmdParserMap.set(Vt.CMD_DEV_PARAM_EXTEND,new Bt)}getCmdParserMap(){return this.cmdParserMap}};class Bt extends A{createCommand(){return new Jt}}class zt extends O{constructor(e){super(Vt.CMD_FILE_BROWSE_DELETE,e,new m)}}class Wt extends T{constructor(e,t,s,a){super(),this.devHandle=0,this.type=0,this.cluster=0,this.last=!1,this.devHandle=e,this.type=t,this.cluster=s,this.last=a}toData(){const e=super.toData(),t=new Uint8Array(e.length+10);let s=0;return t.set(e,s),s+=e.length,t[s]=this.last?1:0,s+=1,t[s]=this.devHandle>>24,t[s+1]=this.devHandle>>16&255,t[s+2]=this.devHandle>>8&255,t[s+3]=255&this.devHandle,s+=4,t[s]=this.type,s+=1,t[s]=this.cluster>>24,t[s+1]=this.cluster>>16&255,t[s+2]=this.cluster>>8&255,t[s+3]=255&this.cluster,s+=4,t}}class Yt extends O{constructor(e){super(Vt.CMD_NOTIFY_PREPARE_ENV,e,new m)}}class Qt extends T{constructor(e){super(),this.env=0,this.env=e}toData(){const e=super.toData(),t=new Uint8Array(e.length+1);let s=0;return t.set(e,s),s+=e.length,t[s]=this.env,s+=1,t}}class Xt extends O{constructor(e){super(Vt.CMD_FORMAT_DEVICE,e,new S)}}class qt extends T{constructor(e){super(),this.devHandle=0,null!=e&&(this.devHandle=e)}toData(){const e=super.toData(),t=new Uint8Array(e.length+9);let s=0;return t.set(e,s),s+=e.length,t[s]=this.devHandle,s+=1,t}}class Kt extends O{constructor(e){super(Vt.CMD_DELETE_FILE_BY_NAME,e,new m)}}class jt extends T{constructor(e){super(),this.fileName=e}toData(){const e=super.toData(),t=new Uint8Array(e.length+9);let s=0;if(t.set(e,s),s+=e.length,this.fileName){const e=Ie(this.fileName);t.set(new Uint8Array(e),s),s+=e.byteLength}return t}}class Jt extends O{constructor(e){super(Vt.CMD_DEV_PARAM_EXTEND,e||new Zt,new $t)}}Jt.OP_FILE_TRANSFER=0,Jt.OP_DELETE_FILE=1,Jt.OP_READ_FILE=2;class Zt extends T{constructor(){super(...arguments),this.op=0,this.paramData=new Uint8Array}toData(){const e=super.toData();console.log("paramData: ",this.paramData);const t=new Uint8Array(e.length+1+this.paramData.length);let s=0;return t.set(e,s),s+=e.length,t[s++]=this.op,t.set(this.paramData,s),s+=this.paramData.byteLength,t}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t+1?C.ERROR_DATA_FORMAT:(this.op=e[t++],this.paramData=e.slice(t,e.byteLength),t+=this.paramData.byteLength,t)}}class $t extends m{constructor(){super(...arguments),this.op=0,this.responseData=new Uint8Array}toData(){const e=super.toData(),t=new Uint8Array(e.length+1);let s=0;return t.set(e,s),s+=e.length,t[s++]=this.op,t.set(this.responseData,s),s+=this.responseData.byteLength,t}parseData(e){let t=super.parseData(e);return t<C.ERROR_NONE?t:e.length<t+1?C.ERROR_DATA_FORMAT:(this.op=e[t++],this.responseData=e.slice(t,e.byteLength),t+=this.responseData.byteLength,t)}}class es{}es.CMD_EXTERNAL_FLASH_IO_CTRL=26,es.CMD_READ_EXTERNAL_FLASH_INFO=214;class ts{constructor(){this.cmdParserMap=new Map,this.cmdParserMap.set(es.CMD_EXTERNAL_FLASH_IO_CTRL,new ss)}getCmdParserMap(){return this.cmdParserMap}}class ss extends A{createCommand(){return new rs}}class as extends O{constructor(){super(es.CMD_READ_EXTERNAL_FLASH_INFO,new T,new ns)}}class ns extends m{constructor(){super(...arguments),this.flash=0,this.fatSize=0,this.system=0,this.systemStatus=0,this.version=0,this.block=0,this.cluster=0,this.matchVersionLen=0,this.revMTU=0,this.width=0,this.height=0}parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;let s=t;if(e.length>=s+4&&(this.flash=Pe(e.slice(s,s+4)),s+=4,e.length>=s+4&&(this.fatSize=Pe(e.slice(s,s+4)),s+=4,e.length>=s+1&&(this.system=e[s],s++,e.length>=s+1&&(this.systemStatus=e[s],s++,e.length>=s+2&&(this.version=Ue(e.slice(s,s+2)),s+=2,e.length>=s+2&&(this.block=Ue(e.slice(s,s+2)),s+=2,e.length>=s+2&&(this.cluster=Ue(e.slice(s,s+2)),s+=2,e.length>=s+2&&(this.matchVersionLen=Ue(e.slice(s,s+2)),s+=2,e.length>=s+this.matchVersionLen))))))))){const t=e.slice(s,s+this.matchVersionLen),a=Fe(Array.from(t));this.matchVersions=a.split(","),s+=this.matchVersionLen,e.length>=s+2&&(this.revMTU=Ue(e.slice(s,s+2)),s+=2,e.length>=s+2&&(this.width=Ue(e.slice(s,s+2)),s+=2,e.length>=s+2&&(this.height=Ue(e.slice(s,s+2)),s+=2)))}return s}}class rs extends O{constructor(e){const t=null==e?new is:e,s=new As;super(es.CMD_EXTERNAL_FLASH_IO_CTRL,t,s),s.setCommand(this),t.setCommand(this)}}class is extends T{constructor(){super(...arguments),this.op=0,this.reserveFlag=0,this.flag=0,this.reserveData=new Uint8Array,this._isNeedHandleOp=!0}setCommand(e){this._cmd=e}toData(){const e=super.toData();let t,s;s=this.flag>this.reserveFlag?this.reserveData:this.getFlagData(),t=new Uint8Array(e.byteLength+2+s.length);let a=0;return t.set(e,a),a+=e.byteLength,t[a++]=this.op,t[a++]=this.flag,s&&(t.set(s,a),a+=s.length),t}getFlagData(){return new Uint8Array}parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;if(e.length<t+2)return C.ERROR_DATA_FORMAT;if(this.op=e[t++],this.flag=e[t++],this._isNeedHandleOp){let s;switch(this.op){case 0:s=new ls,t=s.parseData(e);break;case 1:s=new hs,t=s.parseData(e);break;case 2:s=new cs,t=s.parseData(e);break;case 3:s=new os,t=s.parseData(e);break;case 4:s=new us,t=s.parseData(e);break;case 5:s=new ds,t=s.parseData(e);break;case 6:s=new ps,t=s.parseData(e);break;case 7:s=new _s,t=s.parseData(e);break;case 8:s=new Rs,t=s.parseData(e);break;case 9:s=new Ds,t=s.parseData(e);break;case 10:s=new gs,t=s.parseData(e);break;case 11:s=new Es,t=s.parseData(e);break;case 12:s=new Cs,t=s.parseData(e);break;default:s=this}this._cmd?.setParam(s)}else if(this.flag>this.reserveFlag)this.reserveData=e.slice(t),t=e.length;else{const s=this.parseFlagData(e.slice(t));s<0?t=s:t+=s}return t}parseFlagData(e){return e.length}}class ls extends is{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=0,this.flag=0,this.reserveFlag=1,this.offset=0,this.writeData=new Uint8Array}getFlagData(){const e=new Uint8Array(4+this.writeData.byteLength);return e.set(we(this.offset),0),e.set(this.writeData,4),e}parseFlagData(e){let t=0;return e.length<4?C.ERROR_DATA_FORMAT:(this.offset=Pe(e.slice(t,t+=4)),this.writeData=e.slice(t),t+=this.writeData.length,t)}}class hs extends is{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=1,this.flag=0,this.reserveFlag=1,this.offset=0,this.size=0}getFlagData(){const e=new Uint8Array(6);let t=0;return e.set(we(this.offset),t),t+=4,e.set(ve(this.size),t),e}parseFlagData(e){let t=0;return e.length<6?C.ERROR_DATA_FORMAT:(this.offset=Pe(e.slice(t,t+=4)),this.size=Ue(e.slice(t,t+=2)),t)}}class cs extends is{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=2,this.flag=0,this.reserveFlag=1,this.fileSize=0,this.fileName=new Uint8Array}getFlagData(){const e=new Uint8Array(4+this.fileName.byteLength);let t=0;return e.set(we(this.fileSize),t),t+=4,e.set(this.fileName,t),t+=this.fileName.byteLength,e}parseFlagData(e){let t=0;return e.length<4?C.ERROR_DATA_FORMAT:(this.fileSize=Pe(e.slice(t,t+=4)),this.fileName=e.slice(t),e.length)}}class os extends is{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=3,this.flag=0,this.reserveFlag=5,this.filePath=new Uint8Array}getFlagData(){return 0==this.flag?new Uint8Array:this.filePath}parseFlagData(e){return 0==this.flag||(this.filePath=e),e.length}}class us extends is{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=4,this.flag=0,this.reserveFlag=0,this.offset=0,this.clusterSize=0}getFlagData(){const e=new Uint8Array(6);let t=0;return e.set(we(this.offset),t),t+=4,e.set(ve(this.clusterSize),t),t+=2,e}parseFlagData(e){let t=0;return e.length<6?C.ERROR_DATA_FORMAT:(this.offset=Pe(e.slice(t,t+=4)),this.clusterSize=Ue(e.slice(t,t+=2)),6)}}class ds extends is{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=5,this.flag=0,this.reserveFlag=1,this.filePath=new Uint8Array}getFlagData(){return 0==this.flag?new Uint8Array:this.filePath}parseFlagData(e){return 0==this.flag||(this.filePath=e),e.length}}class ps extends is{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=6,this.flag=0,this.reserveFlag=1}}class _s extends is{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=7,this.flag=0,this.reserveFlag=1}}class Rs extends is{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=8,this.flag=0,this.reserveFlag=1,this.crc16=0}getFlagData(){return ve(this.crc16)}parseFlagData(e){let t=0;return e.length<2?C.ERROR_DATA_FORMAT:(this.crc16=Ue(e.slice(t,t+=2)),e.length)}}class Ds extends is{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=9,this.flag=0,this.reserveFlag=1}}class gs extends is{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=10,this.flag=0,this.reserveFlag=0}}class Es extends is{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=11,this.flag=0,this.reserveFlag=0,this.filePath=new Uint8Array}getFlagData(){return this.filePath}parseFlagData(e){return this.filePath=e,e.length}}class Cs extends is{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.op=12,this.flag=0,this.reserveFlag=0}}class As extends m{constructor(){super(...arguments),this.result=0,this.reserveFlag=0,this.reserveData=new Uint8Array,this._isNeedHandleOp=!0}setCommand(e){this._cmd=e}getFlag(){return this._cmd?.getParam().flag}toData(){const e=super.toData();let t,s;const a=this.getFlag();s=a&&a>this.reserveFlag?this.reserveData:this.getFlagData(),t=new Uint8Array(e.byteLength+1+s.length);let n=0;return t.set(e,n),n+=e.byteLength,t[n++]=this.result,s&&(t.set(s,n),n+=s.length),t}getFlagData(){return new Uint8Array}parseData(e){let t=super.parseData(e);if(t<C.ERROR_NONE)return t;if(e.length<t+1)return C.ERROR_DATA_FORMAT;if(this.result=e[t++],this._isNeedHandleOp){let s;switch(this._cmd?.getParam().op){case 0:case 2:case 5:case 6:case 7:case 9:s=new fs,s.reserveFlag=1;break;case 4:case 10:default:s=new fs,s.reserveFlag=0;break;case 1:s=new Os;break;case 3:s=new Ts;break;case 8:s=new ms;break;case 11:s=new Ss;break;case 12:s=new Ms}this._cmd&&s.setCommand(this._cmd),t=s.parseData(e),this._cmd?.setResponse(s)}else{const s=this.getFlag();if(s&&s>this.reserveFlag)this.reserveData=e.slice(t),t=e.length;else{const s=this.parseFlagData(e.slice(t));s<0?t=s:t+=s}}return t}parseFlagData(e){return e.length}}class fs extends As{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.reserveFlag=0}}class Os extends As{constructor(){super(...arguments),this._isNeedHandleOp=!1,this.reserveFlag=1}getFlagData(){return this.dataBuffer?this.dataBuffer:new Uint8Array}parseFlagData(e){return this.dataBuffer=e,e.length}}class Ts extends As{constructor(){super(...arguments),this.reserveFlag=5,this._isNeedHandleOp=!1}getFlagData(){switch(this.getFlag()){case 0:case 5:if(this.filePath)return this.filePath;break;case 3:if(this.version)return this.version}return new Uint8Array}parseFlagData(e){let t=0;switch(this.getFlag()){case 0:case 5:this.filePath=e,t=e.length;break;case 3:this.version=e,t=e.length}return t}}class ms extends As{constructor(){super(...arguments),this.reserveFlag=1,this._isNeedHandleOp=!1}getFlagData(){if(1===this.getFlag()){return ve(this.leftDataSize?this.leftDataSize:0)}return new Uint8Array}parseFlagData(e){let t=0;if(1===this.getFlag())this.leftDataSize=Ue(e.slice(t,t+2)),t+=2;return t}}class Ss extends As{constructor(){super(...arguments),this.reserveFlag=0}getFlagData(){if(0===this.getFlag()){const e=new Uint8Array(6),t=this.size?this.size:0,s=this.crc16?this.crc16:0;return e.set(we(t),0),e.set(ve(s),4),e}return new Uint8Array}parseFlagData(e){if(e.length<6)return C.ERROR_DATA_FORMAT;let t=0;if(0===this.getFlag())this.size=Pe(e.slice(t,t+=4)),this.crc16=Ue(e.slice(t,t+=2));return t}}class Ms extends As{constructor(){super(...arguments),this.reserveFlag=0}getFlagData(){if(0===this.getFlag()){return we(this.leftSize?this.leftSize:0)}return new Uint8Array}parseFlagData(e){if(e.length<4)return C.ERROR_DATA_FORMAT;let t=0;if(0===this.getFlag())this.leftSize=Pe(e.slice(t,t+=4));return t}}class Ns extends ${}class Is extends U{constructor(){super(...arguments),this.deviceInfoMap=new Map}release(){this.deviceInfoMap.clear()}getReceiveMtu(e){const t=this.getDeviceInfo(e);return null!=t&&t.receiveMtu>0?t.receiveMtu:null}getSendMtu(e){const t=this.getDeviceInfo(e);return null!=t&&t.sendMtu>0?t.sendMtu:null}getDeviceInfo(e){return this.deviceInfoMap.get(e.deviceId)}removeDeviceInfo(e){if(0!=this.deviceInfoMap.size)return this.deviceInfoMap.delete(e.deviceId)}updateDeviceInfo(e,t){this.deviceInfoMap.set(e.deviceId,t)}}class ys{onRcspInit(e,t){}onRcspCommand(e,t){}onRcspResponse(e,t){}onRcspDataCmd(e,t){}onRcspError(e,t,s){}onMandatoryUpgrade(e){}onConnectStateChange(e,t){}}class ws{constructor(){this.cmdSn=0,this.cmdSnMap=new Map,this.cmdSn=parseInt(256*Math.random()+"")}getRcspCmdSeq(e){return this.autoIncSN(e)}autoIncSN(e){const t=this.getCmdSn(e),s=(t+1)%256;return null==e?this.cmdSn=s:this.cmdSnMap.set(e.deviceId,s),t}resetCmdSeq(e){null==e?this.cmdSn=0:this.cmdSnMap.delete(e.deviceId)}release(){this.cmdSn=0,this.cmdSnMap.clear()}getCmdSn(e){if(null==e)return this.cmdSn;let t=this.cmdSnMap.get(e.deviceId);return null==t?this.cmdSn:t}}class vs extends ys{constructor(){super(...arguments),this.mCallbacks=new Array}registerRcspCallback(e){null!=e&&this.mCallbacks.push(e)}unregisterRcspCallback(e){if(null!=e){var t=this.mCallbacks.indexOf(e);-1!=t&&this.mCallbacks.splice(t,1)}}release(){this.mCallbacks.length=0}onRcspInit(e,t){this.callbackRcspEvent({onCallback:s=>{s.onRcspInit(e,t)}})}onRcspCommand(e,t){this.callbackRcspEvent({onCallback:s=>{s.onRcspCommand(e,t)}})}onRcspResponse(e,t){this.callbackRcspEvent({onCallback:s=>{s.onRcspResponse(e,t)}})}onRcspDataCmd(e,t){this.callbackRcspEvent({onCallback:s=>{s.onRcspDataCmd(e,t)}})}onRcspError(e,t,s){this.callbackRcspEvent({onCallback:a=>{a.onRcspError(e,t,s)}})}onMandatoryUpgrade(e){this.callbackRcspEvent({onCallback:t=>{t.onMandatoryUpgrade(e)}})}onConnectStateChange(e,t){this.callbackRcspEvent({onCallback:s=>{s.onConnectStateChange(e,t)}})}callbackRcspEvent(e){0!=this.mCallbacks.length&&this.mCallbacks.forEach((t=>{e.onCallback(t)}))}}class Ps{constructor(){this.mTargetDevice=null,this.mCmdSnGenerator=new ws,this.mRcspCallbackManager=new vs,this.mDeviceInfoManager=new Is;const e={onRcspCommand:(e,t)=>{this.dealWithRcspCommand(e,t)},onRcspResponse:(e,t)=>{this.dealWithRcspResponse(e,t)},onError:(e,t,s)=>{this.mRcspCallbackManager.onRcspError(e,t,s)}};this.mRCSPDataHandler=new v(this,this.mDeviceInfoManager,function(){const e=new Map,t=(new b).getCmdParserMap();for(const s of t)e.set(s[0],s[1]);const s=(new he).getCmdParserMap();for(const t of s)e.set(t[0],t[1]);const a=(new Le).getCmdParserMap();for(const t of a)e.set(t[0],t[1]);const n=(new Ze).getCmdParserMap();for(const t of n)e.set(t[0],t[1]);const r=(new st).getCmdParserMap();for(const t of r)e.set(t[0],t[1]);const i=(new _t).getCmdParserMap();for(const t of i)e.set(t[0],t[1]);const l=(new Gt).getCmdParserMap();for(const t of l)e.set(t[0],t[1]);const h=(new ts).getCmdParserMap();for(const t of h)e.set(t[0],t[1]);return e}(),e)}getUsingDevice(){return this.mTargetDevice}setOnSendDataCallback(e){this.mOnSendDataCallback=e}isDeviceConnected(){return null!=this.getUsingDevice()&&null!=this.getDeviceInfo(this.getUsingDevice())}getDeviceInfo(e){return this.mDeviceInfoManager.getDeviceInfo(e)}addOnRcspCallback(e){this.mRcspCallbackManager.registerRcspCallback(e)}removeOnRcspCallback(e){this.mRcspCallbackManager.unregisterRcspCallback(e)}transmitDeviceStatus(e,t){this.mRcspCallbackManager.onConnectStateChange(e,t),this.handleDeviceStatus(e,t)}transmitDeviceData(e,t){this.handleDeviceReceiveData(e,t)}sendDataToDevice(e,t){return null==this.mOnSendDataCallback?(_("RcspImpl: OnSendDataCallback is null,so sendDataToDevice failed"),!1):this.mOnSendDataCallback.sendDataToDevice(e,t)}sendRCSPCommand(e,t,s,a){if(!this.checkIsValidDevice(e,a))return;if(null==t){const t=C.ERROR_INVALID_PARAM;return void this.callbackCmdError(a,e,t,C.getErrorDesc2(t,"Command is null."))}t.isCommand()&&t.setSn(this.mCmdSnGenerator.getRcspCmdSeq(e));const n=new I(e,t,s,a);this.mRCSPDataHandler.addSendData(n)}syncDeviceInfo(e,t,s){const a=new J(t);this.sendCommand(e,a,{onCmdResponse(e,t){if(t.getStatus()!=m.STATUS_SUCCESS){const s=C.ERROR_REPLY_BAD_STATUS;return void this.onError(e,s,C.getErrorDesc2(s,""+t.getStatus()))}const a=t.getResponse();if(null!=a)o("RcspOpImpl: syncDeviceInfo : "+t),null!=s&&s.onResult(e,a);else{const t=C.ERROR_DATA_FORMAT;this.onError(e,t,C.getErrorDesc2(t,"Get targetInfo is null."))}},onError(e,t,a){null!=s&&s.onError(e,t,a)}})}destroy(){this.mCmdSnGenerator.release(),this.mRcspCallbackManager.release(),this.mTargetDevice=null,this.mRCSPDataHandler.destroy()}getDeviceInfoManager(){return this.mDeviceInfoManager}callbackCmdError(e,t,s,a){null!=e&&e.onError(t,s,C.getErrorDesc2(s,a))}callbackError(e,t,s){const a=C.getErrorDesc2(t,s);_("RcspOpImpl: callbackError : device["+e+"] has an exception: "+t+", "+a),this.mRCSPDataHandler.listener.onError(e,t,a)}sendCommand(e,t,s){this.sendRCSPCommand(e,t,g.DEFAULT_SEND_CMD_TIMEOUT,s)}handleDeviceStatus(e,t){if(null!=t)switch(t){case l.CONNECTION_DISCONNECT:e.equals(this.mTargetDevice)&&(this.mTargetDevice=null,this.getDeviceInfoManager().removeDeviceInfo(e),this.mRCSPDataHandler.stopHandler());break;case l.CONNECTION_CONNECTED:if(null!=this.mTargetDevice){const t="Device is Connected. device : "+e+", connected Device : "+this.mTargetDevice;return o("RcspOpImpl: "+t),void this.callbackError(e,C.ERROR_REPEAT_STATUS,t)}this.mTargetDevice=e,this.mRCSPDataHandler.startHandler(),this.handleDeviceConnectedEvent(e)}}handleDeviceConnectedEvent(e){const t=this.getDeviceInfo(e);if(o("RcspOpImpl: handleDeviceConnectedEvent : "+JSON.stringify(t)),null==t){const t=new Z(4294967295,2),s=this;this.syncDeviceInfo(e,t,{onResult(e,t){s.getDeviceInfoManager().updateDeviceInfo(e,t),o("RcspOpImpl: handleDeviceConnectedEvent : onResult ===> "+JSON.stringify(t)),s.handleDeviceConnectedEvent(e)},onError(e,t,a){s.mRcspCallbackManager.onRcspInit(e,!1),_("RcspOpImpl:  Init RCSP protocol failed. so callback the device is disconnected.\ncode = "+t+", "+a),s.handleDeviceStatus(e,l.CONNECTION_DISCONNECT)}})}else t.mandatoryUpgradeFlag?(t.receiveMtu<g.DEFAULT_PROTOCOL_MTU&&(t.receiveMtu=g.DEFAULT_PROTOCOL_MTU),this.getDeviceInfoManager().updateDeviceInfo(e,t),o("RcspOpImpl: handleDeviceConnectedEvent : device["+JSON.stringify(e)+"] need update."),this.mRcspCallbackManager.onRcspInit(e,!0),this.mRcspCallbackManager.onMandatoryUpgrade(e)):(o("RcspOpImpl: handleDeviceConnectedEvent : init success."),this.mRcspCallbackManager.onRcspInit(e,!0))}checkIsValidDevice(e,t){return!!e.equals(this.mTargetDevice)||(null!=t?this.callbackCmdError(t,e,C.ERROR_DEVICE_OFFLINE,""):this.callbackError(e,C.ERROR_DEVICE_OFFLINE,""),!1)}handleDeviceReceiveData(e,t){null!=e&&null!=t&&0!=t.length&&this.checkIsValidDevice(e,null)&&this.mRCSPDataHandler.addReceiveData(new y(e,t))}dealWithRcspCommand(e,t){if(this.checkIsValidDevice(e,null))if(t.getOpCode()==F.CMD_DATA)this.mRcspCallbackManager.onRcspDataCmd(e,t);else switch(this.mRcspCallbackManager.onRcspCommand(e,t),t.getOpCode()){case F.CMD_DATA:this.mRcspCallbackManager.onRcspDataCmd(e,t);break;case F.CMD_SETTINGS_COMMUNICATION_MTU:const s=t,a=s.getParam().protocolMtu,n=this.getDeviceInfo(e);null!=n&&(n.receiveMtu=a,this.getDeviceInfoManager().updateDeviceInfo(e,n));const r=s.getResponse();null!=r&&(r.setSn(t.getSn()),r.setStatus(m.STATUS_SUCCESS),r.realProtocolMtu=a),s.setCommand(!1),this.sendCommand(e,s,null);case F.CMD_SYS_INFO_AUTO_UPDATE:}}dealWithRcspResponse(e,t){if(this.checkIsValidDevice(e,null)&&t.getStatus()==m.STATUS_SUCCESS&&(this.mRcspCallbackManager.onRcspResponse(e,t),t.getOpCode()===F.CMD_SETTINGS_COMMUNICATION_MTU)){const s=t.getResponse().realProtocolMtu,a=this.getDeviceInfo(e);null!=a&&(a.receiveMtu=s,this.getDeviceInfoManager().updateDeviceInfo(e,a))}}}export{Nt as CmdCancelLargeFileTransfer,ee as CmdChangeCommunicationWay,Ke as CmdControlADVStream,re as CmdCustom,G as CmdData,zt as CmdDeleteFile,Kt as CmdDeleteFileByName,Jt as CmdDeviceExtendParam,Xt as CmdDeviceFormat,je as CmdDeviceRequestOp,de as CmdEnterUpdateMode,_e as CmdExitUpdateMode,rs as CmdExternalFlashCtrl,$e as CmdFunction,ze as CmdGetADVInfo,Y as CmdGetSysInfo,J as CmdGetTargetInfo,ie as CmdInnerCustom,It as CmdLargeFileTransferGetName,St as CmdLargeFileTransferOp,Qe as CmdNotifyADVInfo,Yt as CmdNotifyPrepareEnv,Q as CmdNotifySysInfo,Re as CmdNotifyUpdateFileSize,F as CmdOpCodeBase,tt as CmdOpCodeDirecotoryBrowse,es as CmdOpCodeExternalFlashCtrl,Vt as CmdOpCodeFileRelated,Je as CmdOpCodeFunction,be as CmdOpCodeHeadSet,pt as CmdOpCodeLargeFileTransfer,le as CmdOpCodeOta,ge as CmdQueryUpdateResult,as as CmdReadExternalFlashInfo,Ee as CmdReadFileBlock,wt as CmdReadFileFromDevice,fe as CmdReadFileOffset,Te as CmdRebootDevice,Se as CmdRequestUpdate,Ge as CmdSetADVInfo,se as CmdSetMtu,W as CmdSetSysInfo,ht as CmdStartFileBrowse,At as CmdStartLargeFileTransfer,ut as CmdStartLrcGet,ot as CmdStopFileBrowse,Tt as CmdStopLargeFileTransfer,dt as CmdStopLrcGet,O as Command,M as CommandBase,l as Connection,E as Device,Ns as DeviceInfo,Is as DeviceInfoManager,C as ErrorCode,He as KeySettings,Ve as LedSettings,X as LtvBean,ys as OnRcspCallback,Xe as ParamADVInfo,T as ParamBase,te as ParamCommunicationWay,B as ParamData,Wt as ParamDeleteFile,jt as ParamDeleteFileByName,Zt as ParamDeviceExtendParam,qt as ParamDeviceFormat,ds as ParamExternalFlashDeleteFile,os as ParamExternalFlashDialOperation,us as ParamExternalFlashErase,cs as ParamExternalFlashInsertFile,Es as ParamExternalFlashObtainFileInformation,hs as ParamExternalFlashReadOperation,gs as ParamExternalFlashRestoreSystem,Rs as ParamExternalFlashUQueryWriteData,_s as ParamExternalFlashUpdateDialResources,Ds as ParamExternalFlashUpgradeResourceFlagOperation,ls as ParamExternalFlashWriteOperation,ps as ParamExternalFlashWriteProtectOperation,Cs as ParamExternalObtainRemainingFlashSpace,Ce as ParamFileBlock,et as ParamFunction,We as ParamGetADVInfo,K as ParamGetSysInfo,Mt as ParamLargeFileTransferOp,ae as ParamMtu,Qt as ParamNotifyPrepareEnv,qe as ParamOperation,Ut as ParamReadFileFromDeviceByCluster,Pt as ParamReadFileFromDeviceByFileName,Ft as ParamReadFileFromDeviceByFileNameAndDevHandler,Lt as ParamReadFileFromDeviceCancel,bt as ParamReadFileFromDeviceStop,me as ParamRebootDevice,Me as ParamRequestUpdate,Be as ParamSetADVInfo,it as ParamStartFileBrowse,ft as ParamStartLargeFileTransfer,ct as ParamStopFileBrowse,mt as ParamStopLargeFileTransfer,q as ParamSysInfo,Z as ParamTargetInfo,De as ParamUpdateFileSize,rt as PathData,vs as RcspCallbackManager,g as RcspConstant,Ps as RcspOpImpl,m as ResponseBase,z as ResponseData,$t as ResponseDeviceExtendParam,Ts as ResponseExternalFlashDialOperation,Ss as ResponseExternalFlashGetFileInfo,Ms as ResponseExternalFlashLeftSize,fs as ResponseExternalFlashNone,Os as ResponseExternalFlashReadOperation,ms as ResponseExternalFlashWriteDataResult,Ae as ResponseFileBlock,Oe as ResponseFileOffset,Ye as ResponseGetADVInfo,yt as ResponseLargeFileTransferGetName,ne as ResponseMtu,ns as ResponseReadExternalFlashInfo,xt as ResponseReadFileFromDeviceFileSize,Ht as ResponseReadFileFromDeviceNone,S as ResponseResult,lt as ResponseStartFileBrowse,Ot as ResponseStartLargeFileTransfer,j as ResponseSysInfo,$ as ResponseTargetInfo,R as ab2hex,Ue as bigBytes2ToInt,Pe as bigBytes4ToInt,ye as bin2String,Fe as decodeGBK,D as hexDataCovetToAddress,ve as intToBigBytes2,we as intToBigBytes4,u as logd,_ as loge,d as logi,o as logv,p as logw,r as setLogGrade,i as setLogger,Ie as string2buffer};
